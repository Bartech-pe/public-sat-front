<div class="p-8 bg-white rounded-xl shadow-md">
  <div class="flex flex-wrap items-center justify-between mb-4">
    <div class="flex flex-wrap gap-2 items-center">
      <h2 class="text-2xl font-semibold text-sky-700">
        Registro de Atenciones
      </h2>
      <span class="text-sm text-gray-500 pt-1">(3 registros)</span>
    </div>
    <div class="flex gap-2">
      <p-button
        size="small"
        label="Importar"
        (click)="nuevaAtencion()"
        variant="outlined"
        severity="info"
        styleClass="!rounded-full bg-[#375f95]"
      >
      </p-button>
      <p-button
        size="small"
        label="Nueva Atención"
        (click)="nuevaAtencion()"
        styleClass="!rounded-full bg-[#375f95]"
      >
      </p-button>
    </div>
  </div>

  <div class="">
    <!-- Tabs -->
    <p-tabs
      [(value)]="activeTab"
      (valueChange)="onTabChange($event.toString())"
      class="mb-4"
    >
      <p-tablist>
        <p-tab value="0">Todos mis atenciones</p-tab>
        <p-tab value="1">Mis atenciones abiertas</p-tab>
        <p-tab value="2">Atenciones cerradas</p-tab>
      </p-tablist>

      <p-tabpanels>
        <p-tabpanel value="0">
          <ng-container *ngIf="activeTab === '0'">
            <ng-container *ngTemplateOutlet="tablaTickets"></ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="1">
          <ng-container *ngIf="activeTab === '1'">
            <ng-container *ngTemplateOutlet="tablaTickets"></ng-container>
          </ng-container>
        </p-tabpanel>
        <p-tabpanel value="2">
          <ng-container *ngIf="activeTab === '2'">
            <ng-container *ngTemplateOutlet="tablaTickets"></ng-container>
          </ng-container>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>

    <!-- Tabla PrimeNG -->
    <ng-template #tablaTickets>
      <p-table
        #dt2
        [value]="filteredTickets"
        selectionMode="single"
        [(selection)]="selectedAtencion"
        dataKey="nombre"
        responsiveLayout="scroll"
        class="p-datatable-sm"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5, 10, 20]"
        showGridlines
      >
        <ng-template #caption>
          <div class="flex justify-between">
            <div>
              <p-iconfield iconPosition="left" class="ml-auto">
                <input
                  pInputText
                  type="text"
                  (input)="dt2.filterGlobal($event.target, 'contains')"
                  placeholder="Buscar por palabra clave"
                  class="!rounded-full"
                />
              </p-iconfield>
            </div>
            <div>
              <p-button
                size="small"
                label="Exportar"
                (click)="nuevaAtencion()"
                styleClass="w-full"
                variant="outlined"
                severity="success"
              >
                <iconify-icon [icon]="'ri:file-excel-2-fill'" class="text-xl" />
              </p-button>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr class="uppercase">
            <th pSortableColumn="nombre">
              Nombre <p-sortIcon field="nombre" />
            </th>
            <th pSortableColumn="pipeline">
              Pipeline <p-sortIcon field="pipeline" />
            </th>
            <th pSortableColumn="estado">
              Estado <p-sortIcon field="estado" />
            </th>
            <th pSortableColumn="fecha">
              Fecha de creación <p-sortIcon field="fecha" />
            </th>
            <th class="text-center" pSortableColumn="prioridad">
              Prioridad <p-sortIcon field="prioridad" />
            </th>
            <th pSortableColumn="propietario">
              Asesor <p-sortIcon field="propietario" />
            </th>
            <th pSortableColumn="canal">
              Canal <p-sortIcon field="canal" />
            </th>
            <th pSortableColumn="resultado">
              Resultado <p-sortIcon field="resultado" />
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr [routerLink]="['/adviser/atencion-detalle']">
            <td>
              {{ item.nombre }}
            </td>
            <td>{{ item.pipeline }}</td>
            <td>{{ item.estado }}</td>
            <td>{{ item.fecha }}</td>
            <td class="text-center">
              <span
                class="text-xs font-semibold px-2 py-1 rounded"
                [ngClass]="{
                  'bg-red-100 text-red-800': item.prioridad === 'Alta',
                  'bg-yellow-100 text-yellow-800': item.prioridad === 'Media',
                  'bg-green-100 text-green-800': item.prioridad === 'Baja'
                }"
              >
                {{ item.prioridad }}
              </span>
            </td>
            <td>
              <ng-container *ngIf="item.propietario; else noAsignado">
                {{ item.propietario }}
              </ng-container>
              <ng-template #noAsignado>
                <span class="italic text-gray-400">Sin asignar</span>
              </ng-template>
            </td>
            <td>{{ item.fuente }}</td>
            <td>{{ item.resultado }}</td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>
  </div>
</div>
