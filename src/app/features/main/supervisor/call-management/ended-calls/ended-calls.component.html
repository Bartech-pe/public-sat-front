<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
  @for (item of total(); track $index) {
  <p-card class="text-center">
    <div class="flex items-center justify-center gap-2">
      <iconify-icon [icon]="item.icon" [class]="item.style" />
      <p class="text-xl font-bold">{{ item.name }}</p>
    </div>
    <ng-template pTemplate="content">
      <p class="text-xl font-bold">{{ item.total }}</p>
    </ng-template>
  </p-card>
  }
</div>
<br />

<div class="bg-white shadow rounded-xl p-6 mb-4">
  <div class="flex flex-wrap items-center gap-6">
    <div class="flex items-center gap-2 min-w-fit">
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap"
        >Fecha Inicio:</span
      >
      <p-datepicker
        [iconDisplay]="'input'"
        [showIcon]="true"
        inputId="startDate"
        [(ngModel)]="activeStartDateFilter"
        class="min-w-[200px]"
      />
    </div>

    <div class="flex items-center gap-2 min-w-fit">
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap"
        >Fecha Fin:</span
      >
      <p-datepicker
        [iconDisplay]="'input'"
        [showIcon]="true"
        inputId="endDate"
        [(ngModel)]="activeEndDateFilter"
        class="min-w-[200px]"
      />
    </div>

    <div class="flex items-center gap-2 min-w-fit">
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap"
        >Asesor:</span
      >
      <p-select
        placeholder="Selecciona un Asesor"
        [(ngModel)]="activeAdvisorFilter"
        optionLabel="displayName"
        optionValue="id"
        [options]="advisors()"
        class="min-w-[200px]"
      ></p-select>
    </div>

    <div class="flex items-center gap-2 min-w-fit">
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap"
        >Estado:</span
      >
      <p-select
        placeholder="Selecciona un Estado"
        [(ngModel)]="activeStateFilter"
        [options]="states()"
        optionLabel="name"
        optionValue="callStateId"
        class="min-w-[200px]"
      ></p-select>
    </div>

    <div class="flex items-center gap-2 min-w-fit">
      <span class="text-sm font-medium text-gray-700 whitespace-nowrap"
        >Buscar:</span
      >
      <input
        type="text"
        pInputText
        placeholder="Asesor/Telefono"
        [(ngModel)]="activeSearch"
        class="min-w-[200px]"
      />
    </div>
  </div>
</div>

<section class="w-full mt-0 shadow rounded-xl p-4 bg-white">
  <p-table
    [value]="items()"
    [paginator]="true"
    [rows]="limit()"
    (onPage)="onPageChange($event)"
    [responsiveLayout]="'scroll'"
    sortMode="multiple"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {{ itemsTotal() }}"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name" class="w-48">
          Hora <p-sortIcon field="name" />
        </th>
        <th pSortableColumn="description">
          Asesor <p-sortIcon field="description" />
        </th>
        <th pSortableColumn="date_created_user">
          <div class="flex items-center justify-center">
            Duración (seg)<p-sortIcon field="date_created_user" />
          </div>
        </th>
        <th pSortableColumn="star_date">
          Teléfono <p-sortIcon field="star_date" />
        </th>
        <th pSortableColumn="end_date">
          Estado Final <p-sortIcon field="end_date" />
        </th>
        <th pSortableColumn="estado" class="w-48">
          <div class="flex items-center justify-center">
            Grabación <p-sortIcon field="estado" />
          </div>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-registro>
      <tr>
        <td>{{ registro.entryDate | date : "dd/MM/yyyy HH:mm" }}</td>
        <td>{{ registro.user?.name }}</td>
        <td>
          <div class="flex items-center justify-center">
            {{ registro.seconds | duration }}
          </div>
        </td>
        <td>{{ registro.phoneNumber }}</td>
        <td>
          <div class="flex items-center gap-2">
            <!-- <iconify-icon [icon]="registro.stateIcon" [class]="registro.stateStyle" /> -->
            <label class="text-base">{{ registro.callStatus }}</label>
          </div>
        </td>
        <td class="w-28">
          @if (registro.location==null) {
          <label>No hay grabación</label>
          } @else {
          <button
            pButton
            class="p-button-text"
            (click)="download(registro.location)"
          >
            <iconify-icon [icon]="'mdi:download'" class="text-xl" />
            <label>Grabación</label>
          </button>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>
</section>
